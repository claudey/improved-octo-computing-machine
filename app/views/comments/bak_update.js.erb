var errorInlineBlock = {}
errorInlineBlock = document.querySelector('.errors_inline_form_comment_<%= @comment.parent_id %>')

function fadeOut(object) {
  if (object) {
    object.classList.add('fadeout');
    window.setTimeout(function() {
      if (object) {
        object.innerText = '';
      }
    }, 7000);
  }
}

var commentCount = {}
commentCount = document.querySelector('.comment_count')
var recipeCommentCount = {}
recipeCommentCount = document.querySelector('.recipe-comment-count')
var addCommentForm = {}
addCommentForm = document.querySelector('.comment_new_form')
var editedCommentSection = {}
editedCommentSection = document.querySelector("#comment_<%= @comment.id %>")
var editedCommentContent = {}
editedCommentContent = document.querySelector("#content_comment_<%= @comment.id %>")

// Clear errors in section New Comment
document.querySelector('.errors-comment').innerText = ''

<% if @comment.errors.any? %>
// Errors section
  <% if @comment.reply? %>
  // Reply errors
    errorInlineBlock.insertAdjacentHTML('beforeend', '<%= j render 'shared/errors', resource: @comment %>')
    fadeOut(errorInlineBlock)
    errorInlineBlock.addEventListener("click", (event) => {
      if (errorInlineBlock) {
        errorInlineBlock.innerText = ''
      }
    });
  <% else %>
  // Comment errors
    const buttonReply = document.querySelector('#replay_form_comment_<%= @comment.id %>')
    buttonReply.classList.add('d-none')
    const formEdited = document.querySelector('#form_comment_<%= @comment.id %>')
    formEdited.insertAdjacentHTML('beforebegin', '<%= j render 'shared/errors', resource: @comment %>')
    const inputEdited = document.querySelector('#form_comment_<%= @comment.id %> #form-input_comment_<%= @comment.id %>')
    inputEdited.value = inputEdited.getAttribute('value')
  <% end %>

<% else %>
// Update section
  <% if @comment.reply? %>
  //  Update reply
    debugger;
    document.querySelector('.errors_inline_form_comment_<%= @comment.parent_id %>').innerHTML = ''
    var replySection = document.querySelector('.replies-section-comment_<%= @comment.parent_id %>')
    replySection.insertAdjacentHTML('beforebegin', '<%= j render 'comments/reply', comment: @comment %>');
    document.querySelector('#form-input_comment_<%= @comment.parent_id %>').value = ''
    document.querySelector('#replay_form_comment_<%= @comment.parent_id %>').classList.remove('d-none')
    document.querySelector('#form_comment_<%= @comment.id %>').classList.add('d-none')
  <% else %>
  //  Update comment
    debugger;
    editedCommentSection.innerHTML = ''
    editedCommentSection.insertAdjacentHTML('beforebegin', '<%= j render 'comments/comment', comment: @comment %>')
    commentCount.innerHTML = "<%= t('recipes.show.commented_html', count: @comment.recipe.comments.count) %>"
    if (addCommentForm.classList.contains('d-none')) { addCommentForm.classList.remove('d-none') }
    recipeCommentCount.innerHTML = "<%= t('recipes.show.comments_count', count: @comment.recipe.comments.count)%>"
  <% end %>

<% end %>
